<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

  <head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

      <mvc:resources mapping="/resources/**" location="/resources/" />

      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">


      <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

      <!-- Latest compiled and minified JavaScript -->
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" ></script>

      <link th:href="@{css/studentPage.css}" href="UC04v1/src/main/resources/static/css/studentPage.css" rel="stylesheet" type="text/css" media="screen"/>

  </head>

  <style>
      th{
          width: 80px !important;
      }
      .table tbody tr > td.avail {
          background-color: cornflowerblue !important;
      }
      .table tbody tr > td.avail:hover {
          background-color: royalblue !important;
      }
      .table tbody tr > td.chosen {
          background-color: seagreen !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 13px;
      }
      .table tbody tr > td.chosen:hover {
          background-color: forestgreen !important;
      }
      #schedule-group p{
          margin: 2px;
      }
      #schedule-group div{
          margin-bottom: 5px;
      }

  </style>

  <body>

   <!-- <div class= "container" id="main-container"> -->

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">
          <img th:src="@{img/logo.png}" src="UC04v1/src/main/resources/static/img/logo.png" width="50" height="50">
      </a>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
              <li class="nav-item active">
                  <a class="nav-link" href="#" id="brand-header">TCU Medical School Schedule Builder <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                  <a class="nav-link disabled" href="#" th:text="${stu.getName()}"></a>
                  <p th:text="${stu.getId()}" id="stuid"></p>
              </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
              <img th:src="@{img/main-logo.png}" src="UC04v1/src/main/resources/static/img/main-logo.png" width="150" height="45" style="margin-right: 20px;">
          </form>
      </div>
  </nav>

        <div class="wrapper" id="body-wrapper">
            <div class = "row">
                <div class="col-9" id="weekly-calendar">
                    <h5>Week 1</h5>
                    <table class="table table-dark table-striped">
                        <tr>
                            <th scope="col">&nbsp;</th>
                            <th scope="col"> Sun</th>
                            <th scope="col"> Mon</th>
                            <th scope="col"> Tues</th>
                            <th scope="col"> Wed</th>
                            <th scope="col"> Thur</th>
                            <th scope="col"> Fri</th>
                            <th scope="col"> Sat</th>
                        </tr>
                        <tr>
                            <th scope="row" id="morn1"> Morning</th>
                            <td class="bg-danger" id="na">N/A</td>
                            <td id="0"></td>
                            <td id="1"></td>
                            <td id="2"></td>
                            <td id="3"></td>
                            <td id="4"></td>
                            <td id="5"></td>
                        </tr>
                        <tr>
                            <th scope="row" id="aft1">Afternoon</th>
                            <td class="bg-danger" id="na2">N/A</td>
                            <td id="6"></td>
                            <td id="7"></td>
                            <td id="8"></td>
                            <td id="9"></td>
                            <td id="10"></td>
                            <td id="11"></td>
                        </tr>
                    </table>

                    <h5>Week 2</h5>
                    <table class="table table-dark table-striped">
                        <tr>
                                <th scope="col">&nbsp;</th>
                                <th scope="col"> Sun</th>
                                <th scope="col"> Mon</th>
                                <th scope="col"> Tues</th>
                                <th scope="col"> Wed</th>
                                <th scope="col"> Thur</th>
                                <th scope="col"> Fri</th>
                                <th scope="col"> Sat</th>
                        </tr>
                        <tr>
                                <th scope="row" id="morn2">Morning</th>
                                <td class="bg-danger" id="na3">N/A</td>
                                <td id="12"></td>
                                <td id="13"></td>
                                <td id="14"></td>
                                <td id="15"></td>
                                <td id="16"></td>
                                <td id="17"></td>
                        </tr>
                        <tr>
                                <th scope="row" id="aft2">Afternoon</th>
                                <td class="bg-danger" id="na4">N/A</td>
                                <td id="18"></td>
                                <td id="19"></td>
                                <td id="20"></td>
                                <td id="21"></td>
                                <td id="22"></td>
                                <td id="23"></td>
                        </tr>
                    </table>
                </div>

                <div class="col-3" id="specialty-column">
                    <p class="text-center" id="button-header"><strong>Choose Clerkship</strong></p>
                    <div class = "btn-group-vertical" role="group" id="specialty-buttons">
                         <form id="specialty-chosen">
                            <input type ="submit" class= "btn btn-dark" value="Neurology" id="neuro">
                            <input type ="submit" class= "btn btn-dark" value="Family Medicine" name="fammed">
                            <input type ="submit" class= "btn btn-dark" value="Internal Medicine" name="intmed">
                            <input type ="submit" class= "btn btn-dark" value="Surgery" name="surgery">
                            <input type ="submit" class= "btn btn-dark" value="OBGYN" name="obgyn">
                            <input type ="submit" class= "btn btn-dark" value="Pediatrics" name="pediatrics">
                            <input type ="submit" class= "btn btn-dark" value="Psychiatry" name="psych">
                         </form>


                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-dark disabled" data-toggle="modal" data-target="#scheduleModal" id="schedule-popup">
                            Schedule
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="scheduleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Your Current Schedule</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <ul class="list-group" id="schedule-group">
                                            <!--<li class="list-group-item" ="${schedule}"></li> -->
                                            <!--<h1 id="hold" ="${schedule}"></h1> -->
                                            <h5>Week 1</h5>
                                            <div id="week1"></div>
                                            <h5>Week 2</h5>
                                            <div id="week2"></div>
                                        </ul>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-light" id="schedule-popup-submit">Submit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

             </div>
            <!--
            <div class="row" id="key-row">
                <div class="col-9">
                    <div class="card card-horizontal">
                        <div class="card-body bg-light">
                            <p class="card-title"><strong>Selection Key</strong></p>
                            <p class="card-text">Each color represents a different criteria you have matched with.</p>
                        </div>
                        <div class="card-body bg-light">
                            <div class="row text-center pagination-center">
                                <div class="col-3">
                                    <div class="square" id="personality">
                                    </div>
                                </div>
                                <div class="col">
                                    <p class="key-text">Doctor with matching personality</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-body bg-light">
                            <div class="row text-center pagination-center">
                                <div class="col-3">
                                    <div class="square" id="na">
                                    </div>
                                </div>
                                <div class="col">
                                    <p class="key-text" style="margin-left: 15px;">No matching criteria</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-body bg-light">
                            <div class="row text-center pagination-center">
                                <div class="col-3">
                                    <div class="square" id="location">
                                    </div>
                                </div>
                                <div class="col">
                                    <p class="key-text">Doctor with matching location</p>
                                </div>
                            </div>

                        </div>
                        <div class="card-body bg-light">
                            <div class="row text-center pagination-center">
                                <div class="col-3">
                                    <div class="square" id="match-both">
                                    </div>
                                </div>
                                <div class="col">
                                    <p class="key-text">Matching personality & location</p>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>

            </div>
            -->
        </div>
   <!-- </div> -->
        <script>

            var onProfession = false; //boolean to see whether student is clicked into a Profession or not
            var profession;
            var availResult;

            var studentID = $("#stuid").text();
            console.log(studentID);


            $("#specialty-chosen input[type=submit]").click(function(e){

                e.preventDefault();

                console.log("got schedule click");

                profession = $(this).val();

                var specialty = {
                    "profession": profession
                }

                console.log(specialty);

                var getButton = this;

                if( ! onProfession ){

                    onProfession = true;
                    getAvailableDoctors(specialty);
                    $("#specialty-chosen input[type=submit]").not(getButton).prop("disabled", true);

                }

                else{

                    onProfession = false;
                    $("#specialty-chosen input[type=submit]").not(getButton).prop("disabled", false);
                    updateCalendar();

                }

            });

            $("table tr td").click(function(e){

               // console.log("got table click");

                if( onProfession ){

                    shortenProfName(profession);


                    if( $(this).hasClass("avail") && (profession == "Int. Med." || profession == "Fam. Med." || profession == "Pedi." || profession == "Surg.")) {

                        console.log("double add/double check");
                        var spot = parseInt($(this).attr("id"));
                        console.log("Is at spot " + spot);

                        if( spot < 12 && $("#" + (spot+12)).hasClass("avail") ){
                            console.log("double spot is available, can be added");

                            $("td").each(function() {

                                var data = $(this);
                                if( data.text() == profession){
                                    data.removeClass("chosen");
                                }
                            });

                            $(this).removeClass("avail");
                            $(this).addClass("chosen");
                            $(this).html(profession);
                            $("#" + (spot+12)).removeClass("avail");
                            $("#" + (spot+12)).addClass("chosen");
                            $("#" + (spot+12)).html(profession);
                            updateCalendar(availResult);

                        }
                        else if($("#" + (spot-12)).hasClass("avail")){
                            console.log("double spot is available, can be added");

                            $("td").each(function() {

                                var data = $(this);
                                if( data.text() == profession){
                                    data.removeClass("chosen");
                                }
                            });

                            $(this).removeClass("avail");
                            $(this).addClass("chosen");
                            $(this).html(profession);
                            $("#" + (spot-12)).removeClass("avail");
                            $("#" + (spot-12)).addClass("chosen");
                            $("#" + (spot-12)).html(profession);
                            updateCalendar(availResult);

                        }
                        else{
                            console.log("double not avail, can't be done");

                        }


                    }

                    else if( $(this).hasClass("avail")) {

                        console.log("add one clerk");


                        console.log("want to add " + profession + " to this.");

                        $("td").each(function() {

                            var data = $(this);
                            if( data.text() == profession){
                                data.removeClass("chosen");
                            }
                        });

                        $(this).removeClass("avail");
                        $(this).addClass("chosen");
                        $(this).html(profession);

                        updateCalendar(availResult);

                    }

                    else if( $(this).hasClass("chosen") && $(this).text() == shortenProfName(profession)){

                        if(profession == "Int. Med." || profession == "Fam. Med." || profession == "Pedi." || profession == "Surg." ){

                            console.log("remove double choice for this one..");
                            var spot = parseInt($(this).attr("id"));
                            if( spot < 12 ){
                                $(this).removeClass("chosen");
                                $(this).addClass("avail");
                                $(this).html("");
                                $("#"+(spot+12)).removeClass("chosen");
                                $("#"+(spot+12)).addClass("avail");
                                $("#"+(spot+12)).html("");

                            }
                            else{
                                $(this).removeClass("chosen");
                                $(this).addClass("avail");
                                $(this).html("");
                                $("#"+(spot-12)).removeClass("chosen");
                                $("#"+(spot-12)).addClass("avail");
                                $("#"+(spot-12)).html("");

                            }

                        }
                        else{

                            console.log("removing choice form this spot..");
                            $(this).removeClass("chosen");
                            $(this).addClass("avail");
                            $(this).html("");

                        }

                    }


                }

                else{
                    console.log("not clicked into a profession");
                }

                if(confirmSchedule()){
                    writeSchedule();
                    onProfession = false;
                    $("#specialty-chosen input[type=submit]").prop("disabled", false);
                    updateCalendar();
                }
            });


            function getAvailableDoctors(specialty) {

                $.ajax({
                    type: "POST",
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    url: "/getdocs", // route to hit
                    data: JSON.stringify(specialty), // IMPORTANT

                    success: function (result) {

                        availResult = result;
                        updateCalendar();

                    }
                });
            }

            function updateCalendar(){

                if( onProfession ){

                    //availResult[0] = 0;
                    //availResult[5] = 0;
                    //availResult[17] = 0;

                    for( var i = 0; i<availResult.length; i++){

                        if( availResult[i] > 0){ // there is an availability at this spot

                            if(! $("#" + i).hasClass("chosen")){

                                $("#" + i ).addClass("avail");
                                $("#" + i ).html("");

                            }
                        }

                    }

                }
                else{
                    $("table tr td").removeClass("avail");

                }

            }

            function shortenProfName(prof){
                if( prof == "Neurology"){
                    profession = "Neuro";
                }
                else if( prof == "Internal Medicine"){
                    profession = "Int. Med.";
                }
                else if( prof == "Family Medicine"){
                    profession = "Fam. Med.";
                }
                else if( prof == "Psychiatry"){
                    profession = "Psych.";
                }
                else if(prof == "Pediatrics"){
                    profession = "Pedi.";
                }
                else if(prof == "Surgery") {
                    profession = "Surg.";
                }
                return profession;
            }

            function lengthenProfName(prof){

                if( prof == "Neuro"){
                    prof = "Neurology";
                }
                else if( prof == "Int. Med."){
                    prof = "Internal Medicine";
                }
                else if( prof == "Fam. Med."){
                    prof = "Family Medicine";
                }
                else if( prof == "Psych."){
                    prof = "Psychiatry";
                }
                else if(prof == "Pedi."){
                    prof = "Pediatrics";
                }
                else if(prof == "Surg."){
                    prof = "Surgery";
                }
                return prof;

            }

            function confirmSchedule(){

                var count = 0;

                $("td").each(function() {

                    var data = $(this);

                    if( data.hasClass("chosen")){
                        count = count + 1;
                    }


                });

                if( count == 11){

                    console.log("correct number of clerks");
                    $("#schedule-popup").removeClass("disabled");
                    return true;

                }
                else{

                    console.log("not finished yet");
                    if( ! $("#schedule-popup").hasClass("disabled")){

                        $("#schedule-popup").addClass("disabled");

                    }

                    return false;
                }
            }

            function writeSchedule(){

                console.log("undo button and write schedule");
                $("#week1").html("")
                $("#week2").html("");


                $("td").each(function() {

                    var data = $(this);

                    if( data.hasClass("chosen")){

                        var day = parseInt(data.attr("id"));
                        var clerk = data.text();
                        if( day < 12 ){
                            $("#week1").append("<p>" + convertToSchedule(day, clerk) + "</p>");
                        }
                        else{
                            $("#week2").append("<p>" + convertToSchedule(day, clerk) + "</p>");
                        }


                    }

                });
            }

            function convertToSchedule(day, clerk){

                var dayOfWeek;
                var name = lengthenProfName(clerk);

                if( day == 0 || day == 12){
                    dayOfWeek = "Monday Morning";

                }
                else if( day == 6 || day == 18){
                    dayOfWeek = "Monday Afternoon";
                }
                else if(day == 1 ||  day == 13 ){
                    dayOfWeek = "Tuesday Morning";
                }
                else if( day == 7 || day == 19){
                    dayOfWeek = "Tuesday Afternoon";
                }
                else if(day == 2 || day == 14 ){
                    dayOfWeek = "Wednesday Morning";
                }
                else if(day == 8 || day == 20){
                    dayOfWeek = "Wednesday Afternoon";
                }
                else if(day == 3 || day == 15){
                    dayOfWeek = "Thursday Morning";
                }
                else if(day == 9 || day == 21){
                    dayOfWeek = "Thursday Afternoon";
                }
                else if(day == 4 || day == 16 ) {
                    dayOfWeek = "Friday Morning";
                }
                else if(day == 10 || day == 22) {
                    dayOfWeek = "Friday Afternoon";
                }
                else if(day == 5 || day == 17 ){
                    dayOfWeek = "Saturday Morning";
                }
                else if(day == 11 || day == 23) {
                    dayOfWeek = "Saturday Afternoon";
                }

                var info = name + ": " + dayOfWeek;
                return info;


            }

            $("#schedule-popup-submit").click(function(){
                submitSchedule();
            })

            function submitSchedule(){

                var sched = {};


                $("td").each(function() {

                    var data = $(this);

                    if( data.hasClass("chosen")){

                        var day = data.attr("id");
                        var clerk = data.text();
                        clerk = lengthenProfName(clerk);
                        var name = clerk.replace(/\s/g, '');
                        name = name.toLowerCase();
                        sched[name] = day;

                    }

                });

                sched["id"] = studentID;




                $.ajax({
                    type: "POST",
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    url: "/sendschedule", // route to hit
                    data: JSON.stringify(sched), // IMPORTANT

                    success: function (result) {

                       if (result){
                           console.log("successful submit");
                       }

                    }
                });


                console.log(sched);

            }




            /*
                    1. One clerkship per schedule, when on clerkship be able to click around.
                    2. Keep choice for when they leave that clerkship.
                    2. Family Medicine, Pediatrics, Surgery, Internal Medicine - 2x a week
                    3. Students have to pick the doctor their paired with first.
                    4. Have chosen one of each profession before submit.
                    5. Pass Neurology, 1 Family Medicine - Name and num corresponding to day.

             */

        </script>
  </body>
</html>

