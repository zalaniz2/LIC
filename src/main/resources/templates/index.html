<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:mvc="http://www.springframework.org/schema/mvc">

  <head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

      <mvc:resources mapping="/resources/**" location="/resources/" />

      <!-- Bootstrap CSS -->

      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/css/bootstrap-select.min.css">


      <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

      <!-- Latest compiled and minified JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" ></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/js/bootstrap-select.min.js"></script>

      <link th:href="@{css/studentPage.css}" href="UC04v1/src/main/resources/static/css/studentPage.css" rel="stylesheet" type="text/css" media="screen"/>

  </head>

  <style>
      body{
          min-width: 1300px !important;
          margin: 0 auto !important;
          overflow: hidden;
          background-color: #fcfcfc;
      }

      #specialty-buttons{
          /*margin-top: 25px;*/
      }
      #specialty-buttons .btn{
          margin-bottom: 5px;
      }
      #weekly-calendar{
      }
      #main-container{
          padding-top: 15px;
      }
      #weekly-calendar h5{
          margin-left: 20%;
          font-weight: bold;
          color:#404040;
      }

      #body-wrapper{
          margin: 35px;
      }
      .card {
          display: flex; flex-direction: column;
      }
      .card-horizontal {
          flex-direction: row;
      }

      td:hover{
      }

      #schedule-popup{
          margin-top: 50px;
      }

      .square {
          height: 40px;
          width: 40px;
          margin-top: 20px;
      }
      #personality{
          background-color: cadetblue;
      }
      .key-text{
          font-size: 12px;
          font-weight: bold;
          margin-top: 10px;
          margin-bottom: 0px;
      }
      #na{
          background-color: grey;

      }
      #location{
          background-color: cornflowerblue;
      }
      #match-both{
          background-color: mediumspringgreen;
      }
      #weekly-calendar .table-striped>thead, tr, th, td{
          text-align: center;
          color: #f2f2f2;

      }
      #weekly-calendar tr {
          line-height: 30px;
          line-widows: 30px;
          min-height: 30px;
          height: 30px;
      }
      #weekly-calendar td:hover{
          background-color: #6c3ab7;
      }
      #weekly-calendar table{
          width: 80% !important;
          margin-left: 10%;
          background-color:    #563c7c !important;
          border: 2px solid #563c7c;
      }
      .list-group-item{
          margin-top: 45px;
      }
      #key-row{
          margin-top: -75px;
      }
      hr{
          margin-right: 5%;
          margin-left: 5%;
      }
      #button-header{
          color:#404040;
      }
      #weekly-calendar .table-striped>tbody>tr:nth-child(odd)>td,
      .table-striped>tbody>tr:nth-child(odd)>th {
          background-color: #6f5499;
      }
      #weekly-calendar .table-striped>tbody>tr:nth-child(odd)>td:hover{
          background-color: #7952b3;
      }
      #schedule-popup-submit{
          background-color: #6f5499;
          color:  #f2f2f2;

      }
      #brand-header{
          color: #6f5499;
          font-weight: bolder;
      }

      .match-personality{
          background-color: cadetblue;
      }
      .no-match{
          background-color: grey;
      }
      .u-match-location{
          background-color: cornflowerblue !important;
      }
      .u-match-both{
          background-color: mediumspringgreen !important;
      }
      th{
          width: 80px !important;
      }
      .table tbody tr > td.avail {
          background-color: cornflowerblue !important;
      }
      .table tbody tr > td.avail:hover {
          background-color: royalblue !important;
      }

      .table tbody tr > td.dallas {
          background-color: steelblue !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 10px;
      }
      .table tbody tr > td.ft-worth {
          background-color: mediumslateblue !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 10px;
      }
      .table tbody tr > td.keller {
          background-color: #10707f !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 10px;
      }
      .table tbody tr > td.southlake {
          background-color: seagreen !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 10px;
      }
      .table tbody tr > td.arlington {
          background-color: darkorange !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 10px;
      }
      .table tbody tr > td.mansfield {
          background-color: palevioletred !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 10px;
      }
      .table tbody tr > td.alliance {
          background-color: peru !important;
          color: #f2f2f2;
          font-weight: bold;
          font-size: 10px;
      }
      .table tbody tr > td.chosen:hover {
            background-color: forestgreen !important;
      }
      #schedule-group p{
          margin: 2px;
      }
      #schedule-group div{
          margin-bottom: 5px;
      }
      .active a{
          background-color: #563c7c !important;
      }
      #brand-header{ background-color: transparent !important}

      #button-header{
          margin-top: 15px;
      }
      .btn-warning{
          font-weight: bold;
      }
      #schedule-view-table tr {
          line-height: 100%;
          line-widows: 30px;
          height: 100%;
      }
      #schedule-view-table>th{
          color: black !important;
      }
      #schedule-view-table>td{
          color: black !important;
      }
      #schedule-view-table{
          width: 100% !important;
          margin-left: 0%;
          background-color: white !important;
          border: 1px solid white;
      }
      #schedule-view-table td:hover {
          background-color: transparent;
      }
      .btn.disabled {
          pointer-events: none;
      }
      #final-buttons{
          margin-left: 8%;
          margin-top: -100px;

      }
      #schedule-popup{
          background-color: #6f5499;
          color:  #f2f2f2;
      }
      #sender{
          font-weight: bold;
      }




  </style>

  <body>

   <!-- <div class= "container" id="main-container"> -->

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">
          <img th:src="@{img/logo.png}" src="UC04v1/src/main/resources/static/img/logo.png" width="50" height="50">
      </a>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
              <li class="nav-item active">
                  <a class="nav-link" href="#" id="brand-header">TCU Medical School Schedule Builder <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                 <a class="nav-link disabled" id="stuname" href="#" th:text="${stu.getName()}"></a>
                 <div th:text="${stu.getId()}" id="stuid" class="d-none"></div>
              </li>
          </ul>
          <form class="form-inline my-2 my-lg-0">
              <img th:src="@{img/main-logo.png}" src="UC04v1/src/main/resources/static/img/main-logo.png" width="150" height="45" style="margin-right: 20px;">
          </form>
      </div>
  </nav>
   <!-- <div class="anything" style="position: absolute; z-index: -1; width: 100%; height: 100%">
       <img th:src="@{img/health_center_copy1.jpg}" src="../static/img/health_center_copy1.jpg" alt="" style="width: 100%">
   </div> -->
        <div class="wrapper" id="body-wrapper">
            <div class = "row">
                <div class="col-9" id="weekly-calendar">

                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#rulesModal" id="rules-popup">
                        How To Use
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="rulesModal" tabindex="-1" role="dialog" aria-labelledby="rulesModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="col-12 modal-title text-center" id="rulesModalTitle">How To Use</h4>
                                </div>
                                <div class="modal-body">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5>Week 1</h5>
                    <table class="table table-dark table-striped text-center">
                        <tr>
                            <th scope="col">&nbsp;</th>
                            <th scope="col"> Sun</th>
                            <th scope="col"> Mon</th>
                            <th scope="col"> Tues</th>
                            <th scope="col"> Wed</th>
                            <th scope="col"> Thur</th>
                            <th scope="col"> Fri</th>
                            <th scope="col"> Sat</th>
                        </tr>
                        <tr>
                            <th scope="row" id="morn1"> Morning</th>
                            <td class="bg-danger" id="na">N/A</td>
                            <td id="0" data-toggle="tooltip" data-placement="top" title="Hooray!" ></td>
                            <td id="2" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="4" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="6" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="8" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="10" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                        </tr>
                        <tr>
                            <th scope="row" id="aft1">Afternoon</th>
                            <td class="bg-danger" id="na2">N/A</td>
                            <td id="1" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="3" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="5" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="leaps1" class="bg-danger">LeAPS</td>
                            <td id="9" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                            <td id="11" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                        </tr>
                    </table>

                    <h5>Week 2</h5>
                    <table class="table table-dark table-striped text-center">
                        <tr>
                                <th scope="col">&nbsp;</th>
                                <th scope="col"> Sun</th>
                                <th scope="col"> Mon</th>
                                <th scope="col"> Tues</th>
                                <th scope="col"> Wed</th>
                                <th scope="col"> Thur</th>
                                <th scope="col"> Fri</th>
                                <th scope="col"> Sat</th>
                        </tr>
                        <tr>
                                <th scope="row" id="morn2">Morning</th>
                                <td class="bg-danger" id="na3">N/A</td>
                                <td id="12" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="14" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="16" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="18" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="20" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="22" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                        </tr>
                        <tr>
                                <th scope="row" id="aft2">Afternoon</th>
                                <td class="bg-danger" id="na4">N/A</td>
                                <td id="13" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="15" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="17" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="leaps2" class="bg-danger">LeAPS</td>
                                <td id="21" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                                <td id="23" data-toggle="tooltip" data-placement="top" title="Hooray!"></td>
                        </tr>
                    </table>
                </div>

                <div class="col-3" id="specialty-column">

                    <p class="text-center" id="filter-header"><strong>Choose Location</strong></p>
                    <select class="form-control" id="locations">
                        <option value="Fort Worth">Fort Worth</option>
                        <option value="Dallas">Dallas</option>
                        <!--
                        <option value="Keller">Keller</option>
                        <option value="Southlake">Southlake</option>
                        <option value="Alliance">Alliance</option>
                        -->
                        <option value="Keller/Southlake/Alliance">Keller/Southlake/Alliance</option>
                        <option value="Arlington">Arlington</option>
                        <option value="Mansfield">Mansfield</option>

                    </select>

                    <p class="text-center" id="button-header"><strong>Choose Clerkship</strong></p>
                    <div class = "btn-group-vertical" role="group" id="specialty-buttons">
                         <form id="specialty-chosen">
                            <input type ="submit" class= "btn btn-dark" value="Neurology" id="neuro">
                            <input type ="submit" class= "btn btn-dark" value="Family Medicine" name="fammed">
                            <input type ="submit" class= "btn btn-dark" value="Internal Medicine" name="intmed">
                            <input type ="submit" class= "btn btn-dark" value="Surgery" name="surgery">
                            <input type ="submit" class= "btn btn-dark" value="OBGYN" name="obgyn">
                            <input type ="submit" class= "btn btn-dark" value="Pediatrics" name="pediatrics">
                            <input type ="submit" class= "btn btn-dark" value="Psychiatry" name="psych">
                         </form>

                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-light disabled" data-toggle="modal" data-target="#scheduleModal" id="schedule-popup">
                            Review
                        </button>

                        </div>
                    </div>
                </div>
                <div class="row" id="final-buttons">

                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-danger col-4" data-toggle="modal" data-target="#contactModal" style="margin-top: 50px;" id="contact-admin">
                        Contact Admin.
                    </button>


                    <!-- Modal -->
                    <div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="col-12 modal-title text-center" id="contactModalTitle">Send Message</h4>
                                </div>
                                <div class="modal-body">
                                    <p id="sender"></p>
                                    <form>
                                        <div class="form-group">
                                            <label for="message-text" class="col-form-label">Send a message to the administrator:</label>
                                            <textarea class="form-control" id="message-text"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Send</button>
                                    <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>


            <!-- Modal -->

            <div class="modal fade" id="scheduleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title col-12 text-center" id="exampleModalLabel">Your Current Schedule</h5>
                        </div>
                        <div class="modal-body">
                            <table class="table" id="schedule-view-table" style="color: black !important;">
                                <thead>
                                <tr>
                                    <th scope="col" style="color: black; border-top-color: transparent;">Clerkship</th>
                                    <th scope="col" style="color: black; border-top-color: transparent;">Day</th>
                                    <th scope="col" style="color: black; border-top-color: transparent;">Time</th>
                                    <th scope="col" style="color: black; border-top-color: transparent;">Once a week</th>
                                    <th scope="col" style="color: black; border-top-color: transparent;">Location</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <th scope="schedview1" style="color: black;" id="schedclerk1">Neurology</th>
                                    <td style="color: black;" id="schedday1">Mark</td>
                                    <td style="color: black;" id="schedtime1">Otto</td>
                                    <td style="color: black;" id="schedweek1">@mdo</td>
                                    <td style="color: black;" id="schedloc1">@mdo</td>

                                </tr>
                                <tr>
                                    <th scope="schedview1" style="color: black;" id="schedclerk2">Family Medicine</th>
                                    <td style="color: black;" id="schedday2">Mark</td>
                                    <td style="color: black;" id="schedtime2">Otto</td>
                                    <td style="color: black;" id="schedweek2">@mdo</td>
                                    <td style="color: black;" id="schedloc2">@mdo</td>
                                </tr>
                                <tr>
                                    <th scope="schedview1" style="color: black;" id="schedclerk3">Internal Medicine</th>
                                    <td style="color: black;" id="schedday3">Mark</td>
                                    <td style="color: black;" id="schedtime3">Otto</td>
                                    <td style="color: black;" id="schedweek3">@mdo</td>
                                    <td style="color: black;" id="schedloc3">@mdo</td>

                                </tr>
                                <tr>
                                    <th scope="schedview1" style="color: black;" id="schedclerk4">Surgery</th>
                                    <td style="color: black;" id="schedday4">Mark</td>
                                    <td style="color: black;" id="schedtime4">Otto</td>
                                    <td style="color: black;" id="schedweek4">@mdo</td>
                                    <td style="color: black;" id="schedloc4">@mdo</td>
                                </tr>
                                <tr>
                                    <th scope="schedview1" style="color: black;" id="schedclerk5">OBGYN</th>
                                    <td style="color: black;" id="schedday5">Mark</td>
                                    <td style="color: black;" id="schedtime5">Otto</td>
                                    <td style="color: black;" id="schedweek5">@mdo</td>
                                    <td style="color: black;" id="schedloc5">@mdo</td>
                                </tr>
                                <tr>
                                    <th scope="schedview1" style="color: black;" id="schedclerk6">Pediatrics</th>
                                    <td style="color: black;" id="schedday6">Mark</td>
                                    <td style="color: black;" id="schedtime6">Otto</td>
                                    <td style="color: black;" id="schedweek6">@mdo</td>
                                    <td style="color: black;" id="schedloc6">@mdo</td>
                                </tr>
                                <tr>
                                    <th scope="schedview1" style="color: black;" id="schedclerk7">Psychiatry</th>
                                    <td style="color: black;" id="schedday7">Mark</td>
                                    <td style="color: black;" id="schedtime7">Otto</td>
                                    <td style="color: black;" id="schedweek7">@mdo</td>
                                    <td style="color: black;" id="schedloc7">@mdo</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-dark col-6" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-light col-6" id="schedule-popup-submit">Submit</button>
                        </div>
                    </div>
                </div>




            </div>

        </div>
   <!-- </div> -->
        <script>

            // ***** getLocClass is backwards, must fix later *****

            var onProfession = false; //boolean to see whether student is clicked into a Profession or not
            var profession;
            var availResult;
            var phaseOneType = "";
            var loc = "Fort Worth";

            var spots = {
                "Int. Med": loc,
                "Fam. Med.": loc,
                "Surg.": loc,
                "OBGYN": loc,
                "Pedi.": loc,
                "Psych.": loc,
                "Neuro": loc

            }

            function getLocClass( loc ){

                if( loc == "Neuro"){
                    return "ft-worth";
                }
                if( loc == "Pedi."){
                    return "keller";
                }
                if( loc == "Int. Med."){

                    return "southlake";
                }
                if( loc == "OBGYN"){
                    return "arlington";
                }
                if( loc == "Fam. Med."){
                    return "alliance";
                }
                if( loc == "Surg."){
                    return "mansfield";
                }
                if( loc == "Psych."){
                    return "dallas";
                }

                return "ft-worth";
            }

            function getDocType(myId){

                var d = {
                    "id": myId
                }

                $.ajax({
                    type: "POST",
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    url: "/checkdoc", // route to hit
                    data: JSON.stringify(d), // IMPORTANT

                    success: function (result) {

                        var s = "" + result;

                        if( s == "InternalMedicine"){
                            phaseOneType = "Internal Medicine";
                        }
                        else{
                            phaseOneType = "Family Medicine";
                        }

                        console.log("Phase 1 Doctor is a " + phaseOneType + " doctor.");


                    }
                });


            }

            function alreadyHasSchedule(myId){

                var d = {
                    "id": myId
                }

                $.ajax({
                    type: "POST",
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    url: "/checkstu", // route to hit
                    data: JSON.stringify(d), // IMPORTANT

                    success: function (result) {

                        if( result ){
                            document.location.href = '/finished';

                        }


                    }
                });

            }


           var studentID = $("#stuid").text();

           var stuName = $("#stuname").text();

           alreadyHasSchedule(studentID);
           getDocType(studentID);

           console.log(stuName);


           $("#sender").html(stuName);

            $("#locations").on('change', function(){

                console.log("got click for loaction");
                loc = $("#locations").find(":selected").text();
                console.log(loc);

            });


            $("#specialty-chosen input[type=submit]").click(function(e){

                e.preventDefault();

                console.log("got schedule click");

                profession = $(this).val();

                var specialty = {
                    "profession": profession,
                    "location": loc
                }

                console.log(specialty);

                var getButton = this;

                if( ! onProfession ){

                    onProfession = true;
                    getAvailableDoctors(specialty);
                    $("#specialty-chosen input[type=submit]").not(getButton).prop("disabled", true);
                    $("#locations").prop("disabled", true);

                }

                else{

                    onProfession = false;
                    $("#specialty-chosen input[type=submit]").not(getButton).prop("disabled", false);
                    $("#locations").prop("disabled", false);
                    updateCalendar();
                    updateTooltips();

                }

            });

            $("table tr td").click(function(e){

               // console.log("got table click");

                if( onProfession ){

                    shortenProfName(profession);


                    if( $(this).hasClass("avail") && (profession == "Int. Med." || profession == "Fam. Med." || profession == "Pedi." || profession == "Surg.")) {

                        console.log("double add/double check");
                        var spot = parseInt($(this).attr("id"));
                        console.log("Is at spot " + spot);

                        if( spot < 12 && $("#" + (spot+12)).hasClass("avail") ){
                            console.log("double spot is available, can be added");

                            $("td").each(function() {

                                var data = $(this);
                                if( data.text() == profession){
                                    data.removeClass(); // changed here
                                    data.addClass("avail");
                                }
                            });

                            spots[profession] = loc;
                            console.log(spots);
                            $(this).removeClass("avail");
                          //  $(this).addClass("chosen");
                            $(this).addClass(getLocClass(profession));
                            $(this).html(profession);
                            $("#" + (spot+12)).removeClass("avail");
                          //  $("#" + (spot+12)).addClass("chosen");
                            $("#" + (spot+12)).addClass(getLocClass(profession));
                            $("#" + (spot+12)).html(profession);
                            updateCalendar(availResult);
                            updateTooltips();

                        }

                        else if($("#" + (spot-12)).hasClass("avail")){
                            console.log("double spot is available, can be added");

                            $("td").each(function() {

                                var data = $(this);
                                if( data.text() == profession){
                                    data.removeClass(); // changed here
                                    data.addClass("avail");
                                }
                            });

                            spots[profession] = loc;
                            console.log(spots);
                            $(this).removeClass("avail");
                           // $(this).addClass("chosen");
                            $(this).addClass(getLocClass(profession));
                            $(this).html(profession);
                            $("#" + (spot-12)).removeClass("avail");
                          //  $("#" + (spot-12)).addClass("chosen");
                            $("#" + (spot-12)).addClass(getLocClass(profession));
                            $("#" + (spot-12)).html(profession);
                            updateCalendar(availResult);
                            updateTooltips();

                        }
                        else{
                            console.log("double not avail, can't be done");

                        }


                    }

                    else if( $(this).hasClass("avail")) {

                        console.log("add one clerk");


                        console.log("want to add " + profession + " to this.");

                        $("td").each(function() {

                            var data = $(this);
                            if( data.text() == profession){
                                data.removeClass(); // changed here
                                data.addClass("avail");
                            }
                        });

                        spots[profession] = loc;
                        console.log(spots);
                        $(this).removeClass("avail");
                        //$(this).addClass("chosen");
                        $(this).addClass(getLocClass(profession));
                        $(this).html(profession);
                        updateCalendar(availResult);
                        updateTooltips();

                    }

                    else if( (! $(this).hasClass("avail") ) && $(this).text() == shortenProfName(profession)){

                        if(profession == "Int. Med." || profession == "Fam. Med." || profession == "Pedi." || profession == "Surg." ){

                            console.log("remove double choice for this one..");
                            var spot = parseInt($(this).attr("id"));
                            if( spot < 12 ){
                               // $(this).removeClass("chosen");
                                $(this).removeClass();
                                $(this).addClass("avail");
                                $(this).html("");
                              //  $("#"+(spot+12)).removeClass("chosen");
                                $("#"+(spot+12)).removeClass();
                                $("#"+(spot+12)).addClass("avail");
                                $("#"+(spot+12)).html("");

                            }
                            else{
                                $(this).removeClass(); //here
                                $(this).addClass("avail");
                                $(this).html("");
                                $("#"+(spot-12)).removeClass();
                                $("#"+(spot-12)).addClass("avail");
                                $("#"+(spot-12)).html("");

                            }

                        }
                        else{

                            console.log("removing choice form this spot..");
                            $(this).removeClass();
                            $(this).addClass("avail");
                            $(this).html("");

                        }

                    }


                }

                else{
                    console.log("not clicked into a profession");
                }

                if(confirmSchedule()){
                    writeSchedule();
                    onProfession = false;
                    $("#specialty-chosen input[type=submit]").prop("disabled", false);
                    updateCalendar();
                    updateTooltips();
                }
            });


            function getAvailableDoctors(specialty) {

                if( specialty.profession == phaseOneType){
                    console.log("ONLY GET PHASE 1 DOC INFO!!!");

                    var phaseone = {
                        "id": studentID
                    }

                    $.ajax({
                        type: "POST",
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        url: "/poavail", // route to hit
                        data: JSON.stringify(phaseone), // IMPORTANT

                        success: function (result) {

                            availResult = result;
                            updateCalendar();
                            updateTooltips();

                        }
                    });
                }
                else{

                    $.ajax({
                        type: "POST",
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        url: "/getdocs", // route to hit
                        data: JSON.stringify(specialty), // IMPORTANT

                        success: function (result) {

                            availResult = result;
                            updateCalendar();
                            updateTooltips();

                        }
                    });
                }


            }

            function updateCalendar(){

                if( onProfession ){

                    //availResult[0] = 0;
                    //availResult[5] = 0;
                    //availResult[17] = 0;

                    for( var i = 0; i<availResult.length; i++){

                        if( availResult[i] > 0){ // there is an availability at this spot

                            if( (! $("#" + i).hasClass("ft-worth") ) && (! $("#" + i).hasClass("keller") ) && (! $("#" + i).hasClass("southlake")) && (! $("#" + i).hasClass("dallas") ) && (! $("#" + i).hasClass("arlington") ) && (! $("#" + i).hasClass("alliance"))  && (! $("#" + i).hasClass("mansfield") ) ){

                                $("#" + i ).addClass("avail");
                                $("#" + i ).html("");

                            }

                        }

                    }

                }
                else{
                    $("table tr td").removeClass("avail");

                }

            }

            function updateTooltips(){

                $("td").each(function() {

                    var data = $(this);

                    if( data.hasClass("ft-worth") || data.hasClass("keller") || data.hasClass("southlake") || data.hasClass("dallas") || data.hasClass("arlington") || data.hasClass("alliance") || data.hasClass("mansfield") ){
                        $(this).tooltip('enable');

                        if(  data.hasClass("ft-worth") ) {
                            data.attr('data-original-title', spots["Neuro"]);
                        }
                        else if( data.hasClass("keller") ){
                            data.attr('data-original-title', spots["Pedi."]);

                        }
                        else if( data.hasClass("southlake") ){
                            data.attr('data-original-title', spots["Int. Med."]);
                        }
                        else if( data.hasClass("dallas") ){
                            data.attr('data-original-title', spots["Psych."]);

                        }
                        else if(  data.hasClass("arlington")  ){
                            data.attr('data-original-title', spots["OBGYN"]);

                        }
                        else if( data.hasClass("alliance") ){
                            data.attr('data-original-title', spots["Fam. Med."]);

                        }
                        else if( data.hasClass("mansfield") ){
                            data.attr('data-original-title', spots["Surg."]);

                        }

                    }
                    else{
                        $(this).tooltip('disable');
                    }


                });

            }

            function shortenProfName(prof){
                if( prof == "Neurology"){
                    profession = "Neuro";
                }
                else if( prof == "Internal Medicine"){
                    profession = "Int. Med.";
                }
                else if( prof == "Family Medicine"){
                    profession = "Fam. Med.";
                }
                else if( prof == "Psychiatry"){
                    profession = "Psych.";
                }
                else if(prof == "Pediatrics"){
                    profession = "Pedi.";
                }
                else if(prof == "Surgery") {
                    profession = "Surg.";
                }
                return profession;
            }

            function lengthenProfName(prof){

                if( prof == "Neuro"){
                    prof = "Neurology";
                }
                else if( prof == "Int. Med."){
                    prof = "Internal Medicine";
                }
                else if( prof == "Fam. Med."){
                    prof = "Family Medicine";
                }
                else if( prof == "Psych."){
                    prof = "Psychiatry";
                }
                else if(prof == "Pedi."){
                    prof = "Pediatrics";
                }
                else if(prof == "Surg."){
                    prof = "Surgery";
                }
                return prof;

            }

            function confirmSchedule(){

                var count = 0;

                $("td").each(function() {

                    var data = $(this);

                    if( data.hasClass("ft-worth") || data.hasClass("keller") || data.hasClass("southlake") || data.hasClass("dallas") || data.hasClass("arlington") || data.hasClass("alliance") || data.hasClass("mansfield") ){
                        count = count + 1;
                    }


                });

                if( count == 11){

                    console.log("correct number of clerks");
                    $("#schedule-popup").removeClass("disabled");
                    return true;

                }
                else{

                    console.log("not finished yet");
                    if( ! $("#schedule-popup").hasClass("disabled")){

                        $("#schedule-popup").addClass("disabled");

                    }

                    return false;
                }
            }

            function writeSchedule(){

                console.log("undo button and write schedule");
                $("td").each(function() {

                    var data = $(this);

                    if( data.hasClass("ft-worth") || data.hasClass("keller") || data.hasClass("southlake") || data.hasClass("dallas") || data.hasClass("arlington") || data.hasClass("alliance") || data.hasClass("mansfield") ){

                        var clerk = data.text();
                        var day = data.attr("id");

                        if( clerk == "Neuro"){

                            $("#schedday1").html(turnIntoDay(day));
                            $("#schedtime1").html(turnIntoTime(day));
                            $("#schedweek1").html(isTwiceAWeek(clerk));
                            $("#schedloc1").html(spots[clerk]);
                        }
                        else if( clerk == "Fam. Med."){

                            $("#schedday2").html(turnIntoDay(day));
                            $("#schedtime2").html(turnIntoTime(day));
                            $("#schedweek2").html(isTwiceAWeek(clerk));
                            $("#schedloc2").html(spots[clerk]);
                        }
                        else if( clerk == "Int. Med."){

                            $("#schedday3").html(turnIntoDay(day));
                            $("#schedtime3").html(turnIntoTime(day));
                            $("#schedweek3").html(isTwiceAWeek(clerk));
                            $("#schedloc3").html(spots[clerk]);
                        }
                        else if( clerk == "Surg."){

                            $("#schedday4").html(turnIntoDay(day));
                            $("#schedtime4").html(turnIntoTime(day));
                            $("#schedweek4").html(isTwiceAWeek(clerk));
                            $("#schedloc4").html(spots[clerk]);
                        }
                        else if( clerk == "OBGYN"){

                            $("#schedday5").html(turnIntoDay(day));
                            $("#schedtime5").html(turnIntoTime(day));
                            $("#schedweek5").html(isTwiceAWeek(clerk));
                            $("#schedloc5").html(spots[clerk]);
                        }
                        else if( clerk == "Pedi."){

                            $("#schedday6").html(turnIntoDay(day));
                            $("#schedtime6").html(turnIntoTime(day));
                            $("#schedweek6").html(isTwiceAWeek(clerk));
                            $("#schedloc6").html(spots[clerk]);
                        }
                        else if( clerk == "Psych."){

                            $("#schedday7").html(turnIntoDay(day));
                            $("#schedtime7").html(turnIntoTime(day));
                            $("#schedweek7").html(isTwiceAWeek(clerk));
                            $("#schedloc7").html(spots[clerk]);
                        }

                    }


                });

            }

            function turnIntoDay(day){

                var theDay = parseInt(day);
                var d;

                if( theDay == 0 || theDay == 1 || theDay == 12 || theDay == 13){
                    d = "Monday";
                }
                else if(theDay == 2 || theDay == 3 || theDay == 14 || theDay == 15){
                    d = "Tuesday";
                }
                else if(theDay == 4 || theDay == 5 || theDay == 16 || theDay == 17) {
                    d = "Wednesday";
                }
                else if(theDay == 6 || theDay == 7 || theDay == 18 || theDay == 19){
                    d = "Thursday"
                }
                else if(theDay == 8 || theDay == 9 || theDay == 20 || theDay == 21){
                    d = "Friday";
                }
                else if(theDay == 10 || theDay == 11 || theDay == 22 || theDay == 23){
                    d = "Saturday";
                }

                return d;

            }

            function turnIntoTime(day){

                var theDay = parseInt(day);

                if( theDay % 2 == 0){
                    return "Morning";
                }
                return "Afternoon"


            }

            function isTwiceAWeek(clerk){

                if( clerk == "Int. Med." || clerk == "Fam. Med." || clerk == "Pedi." || clerk == "Surg."){
                    return "Yes";
                }
                return "No";
            }



            $("#schedule-popup-submit").click(function(){
                submitSchedule();
            })

            function submitSchedule(){

                var sched = {};


                $("td").each(function() {

                    var data = $(this);

                    if( data.hasClass("ft-worth") || data.hasClass("keller") || data.hasClass("southlake") || data.hasClass("dallas") || data.hasClass("arlington") || data.hasClass("alliance") || data.hasClass("mansfield")){

                        var day = data.attr("id");
                        var clerk = data.text();
                        var clerkLoc = clerk;
                        clerk = lengthenProfName(clerk);
                        var name = clerk.replace(/\s/g, '');
                        name = name.toLowerCase();
                        var nameLocation = name + "Location";
                        sched[name] = day;
                        sched[nameLocation] = spots[clerkLoc];

                    }

                });

                sched["id"] = studentID;




                $.ajax({
                    type: "POST",
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    url: "/sendschedule", // route to hit
                    data: JSON.stringify(sched), // IMPORTANT

                    success: function (result) {

                       if (result){
                           document.location.href = '/success';

                       }
                       else{
                            console.log("there was a failure.");
                       }

                    }
                });


                console.log(sched);

            }




            /*

                    1. One clerkship per schedule, when on clerkship be able to click around.
                    2. Keep choice for when they leave that clerkship.
                    2. Family Medicine, Pediatrics, Surgery, Internal Medicine - 2x a week
                    3. Students have to pick the doctor their paired with first.
                    4. Have chosen one of each profession before submit.
                    5. Pass Neurology, 1 Family Medicine - Name and num corresponding to day.


             */

        </script>
  </body>
</html>

